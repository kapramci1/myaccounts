<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MyAccounts</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#000000">
<link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect fill='%2300e0b8' width='100' height='100'/><text y='75' font-size='80' fill='%23000'>ðŸ’³</text></svg>">

<style>
:root{
  --bg:#000;
  --card:#121212;
  --accent:#00e0b8;
  --danger:#ff4d4d;
  --text:#fff;
  --muted:#777;
}

*{box-sizing:border-box;}

body{
  margin:0;
  background:var(--bg);
  color:var(--text);
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto;
  overflow:hidden;
}

header{
  text-align:center;
  padding:20px;
  font-size:20px;
  font-weight:600;
}

.page{
  display:none;
  height:calc(100vh - 140px);
  padding:20px;
  overflow-y:auto;
  scrollbar-width:none;
}
.page::-webkit-scrollbar{display:none;}

.page.active{
  display:flex;
  flex-direction:column;
}

.card{
  background:var(--card);
  padding:18px;
  border-radius:20px;
  margin-bottom:15px;
}

.card-title{
  font-size:18px;
  margin-bottom:4px;
}

.total{
  font-size:22px;
  font-weight:700;
  color:var(--accent);
  margin:8px 0 12px 0;
}

.small{
  color:var(--muted);
  font-size:13px;
  margin-bottom:10px;
}

.center-box{
  width:100%;
  max-width:400px;
  margin:auto;
}

select,input{
  width:100%;
  background:none;
  border:none;
  border-bottom:2px solid var(--accent);
  color:var(--text);
  font-size:18px;
  padding:12px 0;
  margin-bottom:25px;
  text-align:center;
  outline:none;
}

button{
  width:100%;
  padding:14px;
  border:none;
  border-radius:30px;
  background:var(--accent);
  color:#000;
  font-size:15px;
  font-weight:600;
  margin-bottom:8px;
}

.secondary{
  background:#222;
  color:#fff;
}

.danger{
  background:var(--danger);
  color:#fff;
}

.nav{
  position:fixed;
  bottom:0;
  width:100%;
  height:70px;
  display:flex;
  background:#111;
  border-top:1px solid #222;
}

.nav button{
  flex:1;
  display:flex;
  align-items:center;
  justify-content:center;
  background:none;
  border:none;
  color:var(--muted);
  font-size:14px;
}

.nav button.active{
  color:var(--accent);
  font-weight:600;
}

.daily{
  display:flex;
  justify-content:space-between;
  padding:6px 0;
  font-size:14px;
}

.expense-item{
  display:flex;
  justify-content:space-between;
  padding:6px 0;
  font-size:13px;
  border-bottom:1px solid #222;
}
</style>
</head>

<body>

<header>MyAccounts</header>

<div id="summary" class="page active"></div>

<div id="expense" class="page">
  <div class="center-box">
    <select id="expenseCard"></select>
    <input type="number" id="amount" placeholder="0 â‚º">
    <button onclick="addExpense()">Kaydet</button>
  </div>
</div>

<div id="cards" class="page">
  <div class="center-box">
    <input type="text" id="bankName" placeholder="Kart Ä°smi">
    <select id="cardType">
      <option value="Hesap KartÄ±">Hesap KartÄ±</option>
      <option value="Kredi KartÄ±">Kredi KartÄ±</option>
    </select>
    <input type="number" id="cutOffDay" placeholder="Kesim GÃ¼nÃ¼ (1-31)">
    <button onclick="saveCard()">Kaydet</button>
  </div>
  <div id="cardList" style="margin-top:25px;"></div>
</div>

<div class="nav">
  <button onclick="showPage('summary')" class="active">Ã–zet</button>
  <button onclick="showPage('expense')">Harcama</button>
  <button onclick="showPage('cards')">Kartlar</button>
</div>

<script>

// Service Worker Registration
if('serviceWorker' in navigator){
  window.addEventListener('load',()=>{
    navigator.serviceWorker.register('sw.js')
      .then(reg=>console.log('SW registered'))
      .catch(err=>console.log('SW error:',err));
  });
}

// Create manifest.json dynamically
const manifest={
  name:"MyAccounts",
  short_name:"MyAccounts",
  start_url:".",
  display:"standalone",
  background_color:"#000000",
  theme_color:"#000000",
  icons:[
    {
      src:"data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512'><rect fill='%2300e0b8' width='512' height='512'/><text y='400' font-size='350' text-anchor='middle' x='256' fill='%23000'>ðŸ’³</text></svg>",
      sizes:"512x512",
      type:"image/svg+xml"
    }
  ]
};

const blob=new Blob([JSON.stringify(manifest)],{type:'application/json'});
const manifestURL=URL.createObjectURL(blob);
document.querySelector('link[rel="manifest"]').setAttribute('href',manifestURL);

let cards=JSON.parse(localStorage.getItem("cards")||"[]");
let expenses=JSON.parse(localStorage.getItem("expenses")||"[]");
let editingId=null;

function save(){
  localStorage.setItem("cards",JSON.stringify(cards));
  localStorage.setItem("expenses",JSON.stringify(expenses));
}

function formatDate(dateStr){
  let d=new Date(dateStr);
  let day=String(d.getDate()).padStart(2,"0");
  let month=String(d.getMonth()+1).padStart(2,"0");
  let year=d.getFullYear();
  return `${day}.${month}.${year}`;
}

function showPage(id){
  document.querySelectorAll(".page").forEach(p=>p.classList.remove("active"));
  document.querySelectorAll(".nav button").forEach(b=>b.classList.remove("active"));
  document.getElementById(id).classList.add("active");
  event.target.classList.add("active");
  render();
}

function saveCard(){
  let name=bankName.value;
  let type=cardType.value;
  let day=parseInt(cutOffDay.value);
  if(!name||!day)return;

  if(editingId){
    let c=cards.find(x=>x.id===editingId);
    c.name=name;
    c.type=type;
    c.cutOffDay=day;
    editingId=null;
  }else{
    cards.push({id:Date.now(),name,type,cutOffDay:day});
  }

  bankName.value="";
  cutOffDay.value="";
  save();
  render();
}

function editCard(id){
  let c=cards.find(x=>x.id===id);
  bankName.value=c.name;
  cardType.value=c.type;
  cutOffDay.value=c.cutOffDay;
  editingId=id;
}

function deleteCard(id){
  if(!confirm("Kart silinsin mi?"))return;
  cards=cards.filter(c=>c.id!==id);
  expenses=expenses.filter(e=>e.cardId!==id);
  save();
  render();
}

function addExpense(){
  if(!amount.value)return;
  expenses.push({
    id:Date.now(),
    cardId:parseInt(expenseCard.value),
    amount:parseFloat(amount.value),
    date:new Date().toISOString()
  });
  amount.value="";
  save();
  render();
}

function deleteExpense(id){
  expenses=expenses.filter(e=>e.id!==id);
  save();
  render();
}

function getPeriodStart(card){
  let today=new Date();
  if(today.getDate()>=card.cutOffDay)
    return new Date(today.getFullYear(),today.getMonth(),card.cutOffDay);
  else
    return new Date(today.getFullYear(),today.getMonth()-1,card.cutOffDay);
}

function render(){

  summary.innerHTML="";

  cards.forEach(card=>{
    let start=getPeriodStart(card);
    let filtered=expenses.filter(e=>
      e.cardId===card.id &&
      new Date(e.date)>=start
    );

    let total=filtered.reduce((s,e)=>s+e.amount,0);

    let html=`<div class="card">
      <div class="card-title">${card.name}</div>
      <div class="small">${card.type} â€¢ Kesim: ${card.cutOffDay}</div>
      <div class="total">${total.toFixed(2)} â‚º</div>`;

    filtered.sort((a,b)=>new Date(b.date)-new Date(a.date))
      .forEach(e=>{
        html+=`
        <div class="expense-item">
          <span>${formatDate(e.date)}</span>
          <span>${e.amount.toFixed(2)} â‚º 
          <span style="color:var(--danger);cursor:pointer;"
            onclick="deleteExpense(${e.id})">âœ•</span>
          </span>
        </div>`;
      });

    html+="</div>";
    summary.innerHTML+=html;
  });

  expenseCard.innerHTML=
    cards.map(c=>`<option value="${c.id}">${c.name}</option>`).join("");

  cardList.innerHTML=
    cards.map(c=>`
      <div class="card">
        <div class="card-title">${c.name}</div>
        <div class="small">${c.type} â€¢ Kesim: ${c.cutOffDay}</div>
        <button class="secondary" onclick="editCard(${c.id})">DÃ¼zenle</button>
        <button class="danger" onclick="deleteCard(${c.id})">Sil</button>
      </div>
    `).join("");
}

render();

</script>
</body>
</html>